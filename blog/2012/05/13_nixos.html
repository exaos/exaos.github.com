<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8"/>
    <title>NixOS -- 全局版本控制的操作系统？</title>
    <link rel="stylesheet" type="text/less" href="../../../style/less/o-blog.less"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <meta name="generator" content="o-blog version 1.2-zh-133-gcf9fd86"/>
    <script src="../../../style/js/less-1.3.0.min.js" type="text/javascript"></script>
    <script src="../../../style/js/jquery-1.7.1.min.js" type="text/javascript"></script>
    <script src="../../../style/bootstrap/js/bootstrap-modal.js" type="text/javascript"></script>
    <script src="../../../style/bootstrap/js/bootstrap-transition.js" type="text/javascript"></script>
    <script src="../../../style/bootstrap/js/bootstrap-dropdown.js" type="text/javascript"></script>
    <script src="../../../style/bootstrap/js/bootstrap-collapse.js" type="text/javascript"></script>
    <script src="../../../style/js/prettify.js" type="text/javascript"></script>
    <script src="../../../style/js/o-blog.linenumber.js" type="text/javascript"></script>
    <script src="../../../style/js/o-blog-fix.js" type="text/javascript"></script>
    
  </head>
  <body>

    <div class="navbar navbar-fixed-top">
      <div class="navbar-inner">
	<div class="container">
	  <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </a>
	  <a class="brand" href="../../../index.html">心蛛小站</a>
	  <div class="nav-collapse collapse">
	    <ul>
<li><a href="#"><i>icon-book icon-white</i> 存档</a>
<ul>
<li><a href="../../../notes/index.html">笔记</a>
</li>
<li><a href="../../../attic/index.html">资料</a>
</li>
<li><a href="../../../attic/exaos.html">心蛛资料</a>

</li>
</ul>

</li>
<li><a href="#"><i>icon-file icon-white</i> 近期博文</a>
<ul>
<li><a href="../../../blog/2013/02/03_tips-for-new-programming-language.html">[译] 怎样学习一门新的编程语言？</a>
</li>
<li><a href="../../../blog/2013/01/28_recovery-win7-dell-n4110.html">恢复一次严重的系统故障 (Windows 7)</a>
</li>
<li><a href="../../../blog/2013/01/11_work-under-win7.html">在 Windows 7 下工作</a>
</li>
<li><a href="../../../blog/2012/12/23_geant4-mswin.html">Geant4 在 Windows 下的安装与使用</a>

</li>
</ul>

</li>
<li><a href="../../../tags/index.html"><i>icon-tags icon-white</i> 标签</a>

</li>
<li><a href="../../../archives.html"><i>icon-list icon-white</i> 归档博文</a>

</li>
<li><a href="#"><i>icon-link icon-white</i> 友情链接</a>
<ul>
<li><a href="http://blog.163.com/y.feng_cn/">freeboy 在网易的博客：NMR</a>
</li>
<li><a href="http://www.changhai.org/">卢昌海的个人主页</a>
</li>
<li><a href="http://www.scipark.net/">科学公园</a>
</li>
<li><a href="http://scienceblogging.org/">ScienceBlogging</a>

</li>
</ul>

</li>
<li><a href="../../../index.xml"><i>icon-rss icon-white</i> RSS订阅</a>
</li>
</ul>


	  </div>
	</div>
      </div>
    </div>
    <div class="subnav subnav-fixed visible-desktop">
      <div class="container">
	<ul class="breadcrumb">
  <li><a href="../../../index.html">首页</a> <span class="divider">/</span></li>
  <li><a href="../../../blog/index.html">blog</a> <span class="divider">/</span></li><li><a href="../../../blog/2012/index.html">2012</a> <span class="divider">/</span></li><li><a href="../../../blog/2012/05/index.html">05</a> <span class="divider">/</span></li><li>NixOS -- 全局版本控制的操作系统？</li>
  </ul>

      </div>
    </div>
    <div id="page" class="container">

  <header class="article-header">

    <div class="well">
      <div class="row">
	<div class="date span1">
	  <div class=" date-d">13</div>
	  <div class=" date-m"><a href="../../../blog/2012/05/index.html">5月</a></div>
	  <div class=" date-y"><a href="../../../blog/2012/index.html">2012</a>
	  </div>
	</div>
	<div class="span1">
	  <div class="qr-code">
  <img src="http://chart.apis.google.com/chart?chs=50x50&cht=qr&chld=|0&chl=http%3a%2f%2fexaos.github.com%2f%2fblog%2f2012%2f05%2f13_nixos.html"
       alt="qr-code" />
</div>

	</div>
	<h1 class="offset2" style="font-size: 250%">NixOS -- 全局版本控制的操作系统？</h1>
      </div>
      <nav>
	<ul class="pager">
	  <li class="previous"><a href="../../../blog/2012/05/03_light-softs.html"><i class="icon-chevron-left"></i>&nbsp;那些小巧的程序们</a></li><li class="next" style="text-align: right;"><a href="../../../blog/2012/05/17_pioneer.html">“先驱者的故事”（《宽容》之序）&nbsp;<i class="icon-chevron-right"></i></a></li>
	</ul>
      </nav>
    </div>

  </header>
  <div class="article-content">
    <p>
你是否在安装软件的过程中饱受过版本变更之苦呢？比如 A 软件需要依赖 glibc 2.5 版本
以下，而 B 软件却又需要 glibc 2.7 以上？而我们知道，同一个系统中基本上只会有一个
版本的 glibc, 这样，你无法让 A 与 B 在系统中共存，不得不遗憾地舍弃其一，或者采用
使用虚拟机之类的臃肿的解决方案。在 Windows 下的程序员经常会遇到的 "DLL Hell" 问题
也与上述情形类似。在遇到这类问题时，你有否想过这样的一个操作系统，不管你的软件是
什么版本，都可以配置一套与之相适应的运行环境出来，并且不需要额外的虚拟机之类的开
销？尚在开发中的 <a href="http://NixOS.org/nixos/">NixOS</a> 或许会是你未来的选择。
</p>
<p>
首先介绍一下 <a href="http://NixOS.org/nix/">Nix</a> &ndash; 一个函数式包管理器 (<b>a purely functional package manager</b>)。
如果你从未听过“函数式” (functional) 的概念，不妨先参照一下 <a href="#zhwiki">函数式编程语言</a> (或
<a href="#enwiki-Functional_Programming">Functional Programming</a>)。所谓的函数式包管理，就是说将软件包当成纯粹函数式编程语言
（比如 Haskell）中的变量──它们由函数生成并且没有任何副作用 (side-effects)，并且
软件包一旦生成将不再改变。Nix 将软件包保存在 <i>Nix</i> 存储池中，通常在目录 <code>/nix/</code>
下，每个软件包都有唯一的子目录，比如：
</p><pre class="example">
/nix/store/r8vvq9kq18pz08v249h8my6r9vs7s0n3-firefox-2.0.0.1/
</pre>

<p>这儿的 <code>r8vvq9kq…</code> 是软件包的唯一标识，它包含了软件包的所有依赖关系（这是软件包
编译时的依赖关系的加密哈希值）。这个特性使得此包管理系统具备许多特有的功能。
</p>
<p>
  <b>多版本系统</b>
</p>
<p>
你可以同时安装一个软件包的多个版本或者不同的编译条件生成的版本。这样，在本文开头
所提到的 "DLL Hell" 的情形自然避免了。
</p>
<p>
另一个重要的效果就是升级或卸载某个应用软件时不会令其它应用软件崩溃，因为这些操作
从不“毁坏性”地升级或者删除被其它软件包所使用的文件。
</p>
<p>
  <b>完备的依赖关系</b>
</p>
<p>
Nix 会帮助你确保包的依赖关系是完全的。通常情况下，你在其它包管理系统 (如 RPM) 下
创建一个包时，你必须为每个包指定好其依赖关系，但这并不能保证这些指定是完全的。比
如你忘记了添加某项依赖关系，在你的机器上编译是完好的，因为你的机器上安装了这个忘
记了添加的依赖软件包，但编译好的包在其他用户机器上则可能无法运行。我就曾经就遇到
过这样的情形，在安装某个家伙提供的 Debian 包时出错，结果就是他忘记了添加包依赖关
系导致的。
</p>
<p>
因为 Nix 并不将包安装在 <b>全局</b> 的位置（比如 <code>/usr/bin</code> ），而是在包指定的目录下，
这样不完全的依赖关系会大大减少。这是因为诸如编译器类的工具并不是从每个包目录 (比
如 <code>/nix/store/5lbfaxb722zp…-openssl-0.9.8d/include</code> ) 下去寻找文件，如果某个包
在你的系统上编译成功，是因为你显式指定好了依赖关系。
</p>
<p>
运行时 (runtime) 的依赖关系是通过扫描 Nix 存储池路径 (比如 <code>r8vvq9kq…</code> ) 来寻找
二进制文件。这听起来有点冒险，但确实工作良好。
</p>
<p>
  <b>多用户支持</b>
</p>
<p>
非特权用户也可以安装软件。每个用户拥有不同的 <i>配置文件</i> , 一组在 Nix 存储池中的软
件包会在用户的路径下出现。如果某用户安装的包其他用户以前已经安装好了，则不会再次
编译或下载。同时，某个用户在某个可能被其它用户使用的软件包中注入特洛依木马也是不
可能的。 (注：这个我有点不太理解，不过有篇论文讲了这个： <a href="http://nixos.org/docs/papers.html#securesharing">ASE 2005 paper</a>)
</p>
<p>
其它还有的 Nix 特性有：
</p><ul>
<li><b>原子升级与回滚</b> (atomic upgrades and rollbacks)
</li>
<li><b>垃圾回收</b> (garbage collection)
</li>
<li><b>函数式包管理语言</b> (functional package language)
</li>
<li><b>透明的源码/二进制布署</b> (transparent source/binary deployment)
</li>
<li><b>二进制补丁</b> (binary patching)
</li>
</ul>




<br><br>

<p>
Nix 是一个包管理器，可运行在大部分 Unix 系统上，包括 Linux, FreeBSD 和 Mac OS
X. 当然也支持在 Windows 上的 Cygwin. 而 NixOS 则是一个基于 Nix 包管理器的 Linux
发行版本。它不仅使用 Nix 作为包管理器，还将其用于系统管理中（比如生成 <code>/etc</code> 目录
下的配置文件等）。也就是说，可以非常方便地将整个系统回滚到以前的配置状态中。当然，
用户也可以用非超级用户权限来安装软件，等等。
</p>
<p>
因为 <a href="http://NixOS.org/nixos/">NixOS</a> 是这样一个可以回滚到某个配置状态的系统，所以可以称其为全局版本控制的操
作系统，这也是本文标题所强调的内容。
</p>
<p>
Nix 及 NixOS 还是一个研究中的项目。 Nix 刚刚于 2012-05-11 发布了 1.0 版本，而
NixOS 也只提供了一个 LiveCD (0.1pre34067-34077) 和简单的安装 CD 映像，其软件池中
提供的软件包尚不及 Debian 的十分之一。但这是个新鲜的内容，其中许多特性相信在未来
会得到更多的发展。只是不知道成熟后的 <a href="http://www.gnu.org/software/hurd/">GNU Hurd</a> 系统会不会采用这套 Nix 模式来面世。
让我们拭目以待。
</p>
  </div>
  
  <footer class="well article-footer">
    发布于 <time datetime="2012-05-13T23:34:00Z"> 2012-05-13 23:34:00</time>.
    <nav class="tag-cloud">
      <h1><i class="icon-tags"></i> 相关标签</h1>
      <ul>
	<li class="label label-inverse small"><a href="../../../tags/8a2b56e293ee788f1057ad236e06559e.html">计算机</a></li>
      </ul>
    </nav>
  </footer>
  <div id="disqus_thread"></div>
<script type="text/javascript">
  /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
  var disqus_shortname = 'exaos-github'; // required: replace example with your forum shortname

  /* * * DON'T EDIT BELOW THIS LINE * * */
  (function() {
  var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
  dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>

      </div>
      <div id="footer">
	<div class="container">
	  <div class="row">
	    <section class="span3">
	      <h1>关于</h1>
	      <p>
心蛛的个人站点，记录一点私人的收藏或点滴。
</p>
	    </section>
	    <nav id="links" class="span3">
	      <h1>链接</h1>
	      <ul>
		<ul>
<li><a href="../../../index.html"><i>icon-home icon-white</i> 首页</a>

</li>
<li><a href="Lisp error in nil: (error ob:post-htmlfile accessing a non-ob:post)"><i>icon-file icon-white</i> 博文</a>

</li>
<li><a href="../../../tags/index.html"><i>icon-tags icon-white</i> 标签</a>

</li>
<li><a href="../../../archives.html"><i>icon-list icon-white</i> 归档</a>

</li>
<li><a href="../../../index.xml"><i>icon-rss icon-white</i> RSS订阅</a>
</li>
</ul>


	      </ul>
	    </nav>
	    <nav id="archives" class="span3">
	      <h1><a href="../../../archives.html">归档</a></h1>
	      <ul>
		<li><a href="../../../blog/2013/02/03_tips-for-new-programming-language.html">[译] 怎样学习一门新的编程语言？</a></li> <li><a href="../../../blog/2013/01/28_recovery-win7-dell-n4110.html">恢复一次严重的系统故障 (Windows 7)</a></li> <li><a href="../../../blog/2013/01/11_work-under-win7.html">在 Windows 7 下工作</a></li> <li><a href="../../../blog/2012/12/23_geant4-mswin.html">Geant4 在 Windows 下的安装与使用</a></li> <li><a href="../../../blog/2012/12/23_coin3d-mswin.html">在 Windows 下使用 Coin3D</a></li> <li><a href="../../../blog/2012/12/23_geant4-cmake.html">使用 CMake 安装 Geant4 (>=9.5)</a></li> <li><a href="../../../blog/2012/12/22_geant4-debian.html">Geant4 在 Debian 下的安装与使用</a></li> <li><a href="../../../blog/2012/09/12_anti-TCM-medicine.html">“中药过敏”与医生的尴尬</a></li> <li><a href="../../../blog/2012/06/20_nix-in-hpc.html">函数式包管理器 Nix 与高性能计算</a></li> <li><a href="../../../blog/2012/06/12_appellation.html">称呼紊乱的年代之家庭称谓</a></li> 
	      </ul>
	    </nav>
	    <nav class="tags span3">
	      <h1><a href="../../../tags/index.html">标签</a></h1>
	      <ul>
  <li style="font-size: 80.00%;"><a href="../../../tags/emacs.html">Emacs</a></li> <li style="font-size: 150.00%;"><a href="../../../tags/mswin.html">MSWIN</a></li> <li style="font-size: 126.67%;"><a href="../../../tags/ocd.html">OCD</a></li> <li style="font-size: 80.00%;"><a href="../../../tags/cmake.html">cmake</a></li> <li style="font-size: 80.00%;"><a href="../../../tags/debian.html">debian</a></li> <li style="font-size: 173.33%;"><a href="../../../tags/devel.html">devel</a></li> <li style="font-size: 126.67%;"><a href="../../../tags/geant4.html">geant4</a></li> <li style="font-size: 126.67%;"><a href="../../../tags/orgmode.html">orgmode</a></li> <li style="font-size: 80.00%;"><a href="../../../tags/fbc026c9fb552701f8db2b0df2aa9114.html">健康</a></li> <li style="font-size: 80.00%;"><a href="../../../tags/3ff3c3e26a68112c11c3e80f2a26896e.html">开发</a></li> <li style="font-size: 80.00%;"><a href="../../../tags/8640cb1581c2ae2de5a1462405b2943b.html">教育</a></li> <li style="font-size: 80.00%;"><a href="../../../tags/ca746b1ff10193a3ce20878dec04a733.html">文字</a></li> <li style="font-size: 103.33%;"><a href="../../../tags/baa5a3ccb5b09a889de80c125e7ddea9.html">文学编程</a></li> <li style="font-size: 103.33%;"><a href="../../../tags/dc723a61b3f6f05dfbe431cd1c3aee7b.html">模拟</a></li> <li style="font-size: 126.67%;"><a href="../../../tags/920632dabac77e0e51002a969396ea04.html">物理</a></li> <li style="font-size: 196.67%;"><a href="../../../tags/ce4ba240fbd95d4863684f78453c8877.html">社会</a></li> <li style="font-size: 80.00%;"><a href="../../../tags/7ddbe15c845fa27a2bab496183042ca6.html">网络</a></li> <li style="font-size: 220.00%;"><a href="../../../tags/8a2b56e293ee788f1057ad236e06559e.html">计算机</a></li> <li style="font-size: 80.00%;"><a href="../../../tags/cd2589e0ae26e3e82ecf567d1d6045c7.html">译文</a></li> <li style="font-size: 80.00%;"><a href="../../../tags/295bb704f5205801d57d672780b94117.html">语言</a></li> 
</ul>

	    </nav>
	  </div>
	</div>
	<div class="copyright" style="text-align: center;">
	  <p>
版权所有 ©2012 <a href="mailto:exaos.lee(at)gmail.com">心蛛</a>. <a href="http://creativecommons.org/licenses/by-nc-sa/2.5/"><img src="http://i.creativecommons.org/l/by-nc-sa/2.5/cn/88x31.png" alt="88x31.png"/></a>
</p>
	  <p>功能取自 <a href="https://github.com/renard/o-blog">o-blog</a>.</p>
	</div>
      </div>
</body>
</html>

