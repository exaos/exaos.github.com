<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<title>我的 MPICH 笔记</title>
<!-- 2013-10-09 三 14:41 -->
<meta  http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta  name="generator" content="Org-mode" />
<meta  name="author" content="Exaos Lee" />
<meta  name="description" content="Level-2 for exporting to HTML"
 />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center; }
  .todo   { font-family: monospace; color: red; }
  .done   { color: green; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  pre.src-sh:before    { content: 'sh'; }
  pre.src-bash:before  { content: 'sh'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-R:before     { content: 'R'; }
  pre.src-perl:before  { content: 'Perl'; }
  pre.src-java:before  { content: 'Java'; }
  pre.src-sql:before   { content: 'SQL'; }

  table { border-collapse:collapse; }
  td, th { vertical-align:top;  }
  th.right  { text-align: center;  }
  th.left   { text-align: center;   }
  th.center { text-align: center; }
  td.right  { text-align: right;  }
  td.left   { text-align: left;   }
  td.center { text-align: center; }
  dt { font-weight: bold; }
  .footpara:nth-child(2) { display: inline; }
  .footpara { display: block; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  /*]]>*/-->
</style>
<link rel="stylesheet" type="text/css" href="../../assets/css/worg.css" />
<link rel="alternate stylesheet" type="text/css" href="../../assets/css/worg-zenburn.css" />
<link rel="alternate stylesheet" type="text/css" href="../../assets/css/worg-classic.css" />

<script type="text/javascript" src="org-info.js">
/**
 *
 * @source: org-info.js
 *
 * @licstart  The following is the entire license notice for the
 *  JavaScript code in org-info.js.
 *
 * Copyright (C) 2012-2013  Sebastian Rose
 *
 *
 * The JavaScript code in this tag is free software: you can
 * redistribute it and/or modify it under the terms of the GNU
 * General Public License (GNU GPL) as published by the Free Software
 * Foundation, either version 3 of the License, or (at your option)
 * any later version.  The code is distributed WITHOUT ANY WARRANTY;
 * without even the implied warranty of MERCHANTABILITY or FITNESS
 * FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.
 *
 * As additional permission under GNU GPL version 3 section 7, you
 * may distribute non-source (e.g., minimized or compacted) forms of
 * that code without the copy of the GNU GPL normally required by
 * section 4, provided you include this license notice and a URL
 * through which recipients can access the Corresponding Source.
 *
 * @licend  The above is the entire license notice
 * for the JavaScript code in org-info.js.
 *
 */
</script>

<script type="text/javascript">

/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2013 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/

<!--/*--><![CDATA[/*><!--*/
org_html_manager.set("TOC_DEPTH", "4");
org_html_manager.set("LINK_HOME", "../../index.html");
org_html_manager.set("LINK_UP", "index.html");
org_html_manager.set("LOCAL_TOC", "1");
org_html_manager.set("VIEW_BUTTONS", "0");
org_html_manager.set("MOUSE_HINT", "underline");
org_html_manager.set("FIXED_TOC", "0");
org_html_manager.set("TOC", "1");
org_html_manager.set("VIEW", "info");
org_html_manager.setup();  // activate after the parameters are set
/*]]>*///-->
</script>
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012  Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="org-div-home-and-up">
 <a accesskey="h" href="index.html"> UP </a>
 |
 <a accesskey="H" href="../../index.html"> HOME </a>
</div><div id="content">
<h1 class="title">我的 MPICH 笔记</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#sec-1">MPICH2 的初步使用</a>
<ul>
<li><a href="#sec-1-1">安装</a></li>
<li><a href="#sec-1-2">本地测试</a></li>
<li><a href="#sec-1-3">集群测试</a></li>
</ul>
</li>
<li><a href="#sec-2">MPICH2 的性能测试</a></li>
</ul>
</div>
</div>

<div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1">MPICH2 的初步使用</h2>
<div class="outline-text-2" id="text-1">
</div><div id="outline-container-sec-1-1" class="outline-3">
<h3 id="sec-1-1">安装</h3>
<div class="outline-text-3" id="text-1-1">
<p>
参考安装文档，并配置好运行环境。在 Rocks 系统上，可使用 mpi-selector 选择系统安装好的 MPICH 环境。
</p>
</div>
</div>
<div id="outline-container-sec-1-2" class="outline-3">
<h3 id="sec-1-2">本地测试</h3>
<div class="outline-text-3" id="text-1-2">
<ol class="org-ol">
<li>启动 <b>mpd</b> 任务管理器
<pre class="example">
$ mpd &amp;
</pre>
</li>
<li>使用 <b>mpdtrace</b> 查看机器状态，其结果如下所示：
<pre class="example">
$ mpdtrace
 node0
</pre>
</li>
<li>编写测试程序，比如 <code>mpihello.c</code>, 内容可以如下：
<div class="org-src-container">

<pre class="src src-c"><span style="color: #c397d8;">#include</span> <span style="color: #b9ca4a;">&lt;stdio.h&gt;</span>
<span style="color: #c397d8;">#include</span> <span style="color: #b9ca4a;">&lt;stdlib.h&gt;</span>
<span style="color: #c397d8;">#include</span> <span style="color: #b9ca4a;">&lt;mpi.h&gt;</span>

<span style="color: #e7c547;">int</span> <span style="color: #7aa6da;">main</span>(<span style="color: #e7c547;">int</span> <span style="color: #e78c45;">argc</span>, <span style="color: #e7c547;">char</span> *<span style="color: #e78c45;">argv</span>[])
{
  <span style="color: #e7c547;">int</span>  <span style="color: #e78c45;">numprocs</span>, <span style="color: #e78c45;">rank</span>, <span style="color: #e78c45;">namelen</span>;
  <span style="color: #e7c547;">char</span> <span style="color: #e78c45;">processor_name</span>[MPI_MAX_PROCESSOR_NAME];

  MPI_Init(&amp;argc, &amp;argv);
  MPI_Comm_size(MPI_COMM_WORLD, &amp;numprocs);
  MPI_Comm_rank(MPI_COMM_WORLD, &amp;rank);
  MPI_Get_processor_name(processor_name, &amp;namelen);

  printf(<span style="color: #b9ca4a;">"Process %d on %s out of %d\n"</span>, rank, processor_name, numprocs);

  MPI_Finalize();

  <span style="color: #c397d8;">return</span> EXIT_SUCCESS;
}
</pre>
</div>
<p>
然后使用 <code>mpicc</code> 进行编译：
</p>
<pre class="example">
$ mpicc -o mpihello mpihello.c
</pre>
</li>
<li>使用命令 <code>mpirun</code> 运行编译后的程序
<pre class="example">
$ mpirun -np 4 ./mpihello
Process 1 on node0.hpc.cndc out of 4
Process 2 on node0.hpc.cndc out of 4
Process 0 on node0.hpc.cndc out of 4
Process 3 on node0.hpc.cndc out of 4
</pre>
<p>
其中参数 <code>-np</code> 表示需要使用的 CPU 数目。
</p>
</li>
</ol>
</div>
</div>
<div id="outline-container-sec-1-3" class="outline-3">
<h3 id="sec-1-3">集群测试</h3>
<div class="outline-text-3" id="text-1-3">
<ol class="org-ol">
<li>与本地测试同样的步骤，第一步需要启动 mpd 任务守护进程。所不同的是并不是直接调用 mpd 进程，而是通过 mpdboot 来启动。
<ol class="org-ol">
<li>首先，需要准备一份参与计算的机器列表文件，比如 <code>mpd.hosts</code>, 其内容大致如下：
<pre class="example">
compute-0-0
compute-0-1
compute-0-4
compute-0-2
compute-0-3
compute-0-5
</pre>
<p>
当然，需要在你的 <code>/etc/hosts</code> 文件中首先定义好所有的主机名。
</p>
</li>
<li>然后执行 <code>mpdboot</code> 命令
<pre class="example">
$ mpdboot -n 6 -f mpd.hosts
</pre>
</li>
</ol>
</li>
<li>然后执行 <code>mpdtrace</code> 查看参与计算的节点是否打开
<pre class="example">
$ mpdtrace
node0
compute-0-0
compute-0-2
compute-0-1
compute-0-4
compute-0-3
</pre>
</li>
<li>编译测试程序，比如 <code>mpich2</code> 中自带的示例 <code>cpi.c</code>:
<pre class="example">
$ mpicc -o cpi cpi.c
</pre>
</li>
<li>使用 <code>mpirun</code> 执行编译后的程序
<pre class="example">
$ mpirun -np 6 ./cpi
Process 0 on node0.hpc.cndc
Process 2 on compute-0-2.local
Process 1 on compute-0-0.local
Process 3 on compute-0-1.local
Process 4 on compute-0-4.local
Process 5 on compute-0-3.local
pi is approximately 3.1416009869231249, Error is 0.0000083333333318
wall clock time = 0.005853
</pre>
</li>
</ol>
</div>
</div>
</div>
<div id="outline-container-sec-2" class="outline-2">
<h2 id="sec-2">MPICH2 的性能测试</h2>
</div>
</div>
<div id="postamble" class="status">
<div id="disqus_thread"></div>
<p>版权所有 ©2013: Exaos Lee | Date: <span class="timestamp-wrapper"><span class="timestamp">[2011-10-14 五]</span></span> | Generated by <a href="http://www.gnu.org/software/emacs/">Emacs</a> 24.3.50.1 (<a href="http://orgmode.org">Org</a> mode 8.2), <a href="http://validator.w3.org/check?uri=referer">Validate</a>, <a href="http://creativecommons.org/licenses/by-nc-sa/2.5/"><img src="http://i.creativecommons.org/l/by-nc-sa/2.5/cn/88x31.png" alt="88x31.png"/></a></p>
<script type="text/javascript">
  var disqus_shortname = 'exaos-github';
  (function() { var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
  dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq); })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</p>
</div>
</body>
</html>