# -*- mode: org; coding: utf-8; -*-
#+SETUPFILE: ../../../setup/ox-tmpl/l2.org
#+HTML_LINK_UP: ../index.html
#+TITLE: NNGS in CIAE 的安装
#+AUTHOR: 心蛛
#+DATE: [2005-04-17 03:27:00]

在我们院内自己组的服务器上装了一个围棋服务器，可惜院内几乎没有人登陆。 :-( 还是
简单记录一下吧。至少我努力去营造一个氛围，尽管应着瘳瘳。

#+HTML: <hr />

NNGS in CIAE 的安装, crazycat | 2004年十二月26日, 00:07

简记了在 NTOF 主机上安装围棋服务器的经过。

安装方法：
1. 解压 =nngs-1.1.16= 和 =mlrate-1.2=
2. 将 =mlrate-1.2= 的源文件放在 nngs 目录下的 =mlrate/src= 目录下，否则在编译时
   会出现 include 的路径问题。
3. 修改 =$NNGS/mlrate/src= 目录下的 Makefile 文件，在 ~CFLAGS=...~ 一行加上
   : -D_BSD_SOURCE -D_POSIX_C_SOURCE=2
4. 在 =$NNGS/mlrate/src= 目录下执行 make 命令
5. 修改 =$NNGS/src= 下的 =nngsconfig.h= 和 =nngsmain.h= 文件，使之满足特定服务器
   的内容。
6. 对其它的源文件做相应的修改，在 =$NNGS= 下执行 make 和 make install
7. 在 =$NNGS/mlrate/src= 下执行 make install
8. 服务器的后期配置及测试。

问题：
1. =-Wp,-lang-c89= 的定义 -- 修改 =configure.in=, =configure=, 注释掉相关的内容
   即可。
2. =dmalloc.h= 不能使用，因此在 =./configure= 时不能加上 =enable-dmalloc= 的选项。
3. =missing.h= 中注释掉 =ftruncate(int fd, off_t pos)= 的声明。
4. =src/mink.c= 中对 =random= 的声明需要注释掉。
5. =mlrate= 的 Makefile 中不可以使用 gdbm 相关的内容，但必需要有声明
   : -D_BSD_SOURCE -D_POSIX_C_SOURCE=2

日志：
1. 2005.01.06 目前尚没有进行后期的配置与测试。
2. 2005.01.10
   - 执行测试时出现 Segmentation fault，原因未清。
   - 更换 =missing.h= 中的 =ftruncate(...)= 为 =#include=, 结果——无效，同样出现
     Segmentation fault
3. 2005.01.10 14:00, 在 ntof 主机上
   - 重新编译：通过！
   - 测试运行：通过！
   - 暂时将服务存放在 ntof 上，以用户 nngs (uid=gid=96) 运行此服务。
